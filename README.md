Ссылка на репозиторий:  https://github.com/VladislavBeres/web-larek-frontend

# Проектная работа "Веб-ларек"

Интернет-магазин с товарами для веб-разработчиков. Позволяет просматривать каталог, добавлять товары в корзину и оформлять заказ.

Для данной проектной работы я выбираю архетиктуру "MVP" 

(Model-View-Presenter) — архитектурный паттерн в программировании, который разделяет приложение на три компонента: модель, представление и презентер. Основная идея — разделить ответственности между компонентами так, чтобы изменения в одном компоненте не влияли на другие. Это делает код более поддерживаемым и позволяет легче тестировать компоненты независимо друг от друга.

Основные слои и части:

  Модель данных (Model) — управляет состоянием приложения, хранит данные и бизнес-логику (CartModel, ProductModel).

  Представления (View/Component) — отвечает за визуальное отображение данных и интерфейса (ProductCard, ProductCard, CheckoutStepOne, CheckoutStepTwo, OrderSuccess, BasketView).

  Презентеры (Presenter) — связующее звено между моделью и представлением, управляет логикой взаимодействия и обновлениями интерфейса (ProductListPresenter, CheckoutPresenter).

  Всплывающие окна (Modal) — отдельный компонент для отображения модальных диалогов.

  Событийная система (EventEmitter) — обеспечивает коммуникацию между компонентами через события.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

<!-- Работа с событиями (events.ts) -->

## Класс: EventEmitter

Брокер событий. В расширенных вариантах есть возможность подписаться на все события
или слушать события по шаблону например

## Методы:

1. on - Установает обработчик на событие
2. off - Снимает обработчик с события
3. emit - Иницилизирует событие с данными
4. onAll - Слушает все события
5. offAll - Сбрасывает все обработчики
6. trigger - Создает коллбек триггер, генерирующий событие при вызове

<!-- Работа с API (api.ts) -->

## Класс: Api

В проекте используется универсальный класс Api для выполнения HTTP-запросов к серверу. Он инкапсулирует методы GET, POST, PUT, DELETE с единым обработчиком ошибок.

Методы:

1. constructor(baseUrl: string, options?: RequestInit) - Устанавливает базовый URL и заголовки
2. get(uri: string) - Выполняет GET-запрос по заданному URI
3. post(uri: string, data: object, method = 'POST') - Выполняет POST, PUT или DELETE-запрос с телом
4. handleResponse(response: Response) - Обрабатывает JSON-ответ или ошибку

 ApiListResponse<Type> — обёртка для списка с total и items

 ApiPostMethods — поддерживаемые HTTP-методы: 'POST', 'PUT', 'DELETE'


## Класс Modal

Отвечает за работу с модальными окнами.

 ## Свойства:

 1. modalElement: HTMLElement — контейнер модального окна.
 2. modalContent: HTMLElement — область содержимого окна.
 3. closeButton: HTMLElement — кнопка закрытия.
 4. Конструктор:
 5.  Инициализирует элементы и устанавливает обработчики событий.

## Методы: 

 1. open(content: HTMLElement): void — открывает модальное окно с указанным содержимым.
 2. close(): void — закрывает окно и очищает содержимое.
 3. setContent(content: HTMLElement): void — заменяет содержимое модального окна.
 4. setEventListeners(): void — добавляет обработчики кликов и клавиши Escape для закрытия.
 5. private onEscClose(e: KeyboardEvent): void — закрытие окна по Escape.


## Класс ProductListPresenter

Управляет отображением списка продуктов и взаимодействием с корзиной и модальным окном.

 ## Свойства:
 1. modal: Modal — модальное окно.
 2. container: HTMLElement — контейнер для отрисовки списка.
 3. model: ProductModel — модель продуктов.
 4. cartModel: CartModel — модель корзины. 

 ## Методы:

 1. async init(): Promise<void> — загружает продукты из модели и вызывает render.
 2. render(products: Product[]): void — очищает контейнер и создаёт карточки продуктов.

## Класс CheckoutPresenter

Управляет двухшаговым оформлением заказа.

 ## Свойства:

 1. api: Api — работа с сервером.
 2. stepOne: CheckoutStepOneComponentInterface — первый шаг оформления.
 3. stepTwo: CheckoutStepTwoComponentInterface — второй шаг оформления.
 4. events: EventEmitter — система событий.
 5. cartItems: CartItem[] — товары из корзины.
 6. modal: Modal — модальное окно.

 ## Методы:

 1. submitOrder(): void — проверяет валидность второго шага, формирует данные заказа, отправляет на сервер, обрабатывает     результат. 
 2. nextStep(): void — проверяет валидность первого шага, открывает второй шаг.
 3. startCheckout(): void — открывает первый шаг оформления и подписывается на событие отправки формы.
 4. private showSuccessModal(total: number): void — отображает модальное окно успешного оформления.

## Класс CartModel

Управляет данными корзины и хранит состояние.

 ## Свойства:

 1. emitter: EventEmitter — система событий.
 2. items: Map<string, CartItem> — коллекция товаров с количеством.
 3. storageKey: string — ключ для локального хранилища.
 

 ## Методы:

 1. add(product: Product): void — добавляет товар в корзину или увеличивает количество.
 2. remove(productId: string): void — удаляет товар из корзины.
 3. clear(): void — очищает корзину.
 4. has(productId: string): boolean — проверяет наличие товара.
 5. getTotalPrice(): number — считает итоговую стоимость.
 6. getTotalItemsCount(): number — возвращает количество товаров.
 7. private saveToStorage(): void — сохраняет корзину в localStorage.
 8. getAll(): CartItem[] — возвращает массив товаров.
 9. private loadFromStorage(): void — загружает корзину из localStorage.
 10. private emitUpdate(): void — вызывает событие обновления корзины.

## Класс BasketView

Отвечает за отображение корзины и взаимодействие с ней.

 ## Свойства:

 1. element: HTMLElement — корневой элемент корзины в шапке.
 2. cartModel: CartModel — модель корзины.
 3. modal: Modal — модальное окно.
 4. events: EventEmitter — система событий.

 ## Методы:

 1. setEventListeners(): void — подписка на клик по иконке корзины, открытие модального окна.
 2. renderBasket(): HTMLElement — генерирует DOM-элементы корзины с товарами и кнопками удаления.
 3. render(): void — обновляет счётчик товаров в корзине.

## Класс CheckoutStepOne

Компонент первого шага оформления заказа. Отображает форму с полем адреса и кнопками выбора способа оплаты (карта или наличные).

 ## Свойства:
 1. element: DOM-элемент формы.
 2. selectedPayment: выбранный способ оплаты ("card" или "cash").
 3. validator: экземпляр класса FormValidator для валидации формы.

 ## Методы:

 1. setupValidator() — добавляет правила валидации формы.
 2. setEventListeners() — навешивает обработчики на кнопки оплаты, поле адреса и сабмит формы.
 3. updatePaymentButtons() — обновляет внешний вид кнопок в зависимости от выбранного способа оплаты.
 4. validateForm() — проверяет форму и активирует кнопку «Далее» при валидных данных.
 5. emitSubmit() — вызывает кастомное событие "formSubmit" при успешной валидации.
 6. showError(message: string) — отображает сообщение об ошибке.
 7. clearError() — очищает сообщение об ошибке.
 8. setNextButtonEnabled(enabled: boolean) — активирует/деактивирует кнопку «Далее».
 9. getFormData() — возвращает объект { payment, address }.
 10. isValid() — возвращает булево значение, прошла ли форма валидацию.
 11. reset() — очищает форму и сбрасывает состояние кнопок.

## Класс CheckoutStepTwo

Компонент второго шага оформления заказа. Содержит форму с полями email и телефона.

 ## Свойства:

 1. element: DOM-элемент формы.
 2. validator: экземпляр FormValidator с правилами валидации email и телефона.

 ## Методы:

 1. setupValidator() — добавляет правила валидации email и телефона.
 2. setEventListeners() — навешивает обработчики на поля и сабмит формы.
 3. validateForm() — проверяет форму и активирует кнопку при валидных данных.
 4. emitSubmit() — вызывает кастомное событие "formSubmit" с данными формы.
 5. getFormData() — возвращает объект { email, phone }.
 6. showError(message: string) — показывает сообщение об ошибке.
 7. clearError() — очищает сообщение об ошибке.
 8. setSubmitButtonEnabled(enabled: boolean) — активирует/деактивирует кнопку.
 9. isValid() — возвращает true, если все данные валидны.
 10. reset() — очищает поля и ошибки формы.

## Класс FormValidator

Обеспечивает валидацию формы с помощью добавленных правил.

 ## Свойства:

 1. rules: массив объектов с функцией проверки и сообщением об ошибке.

 ## Методы:

 1. addRule(validateFn: () => boolean, errorMessage: string) — добавляет правило валидации.
 2. validate() — проверяет все правила, возвращает { valid: boolean, error?: string }.
 3. clearRules() — очищает все добавленные правила.

## Класс OrderSuccess

Компонент, отображающий модальное окно после успешного оформления заказа.

 ## Свойства:

 1. element: DOM-элемент с контентом.
 2. onCloseCallback: коллбэк для действия при закрытии окна.

 ## Методы:

 1. setTotal() — отображает итоговую сумму.
 2. onClose() — устанавливает функцию, вызываемую при закрытии окна.
 3. setEventListeners() — навешивает обработчик на кнопку закрытия.

## Класс ProductCard

Представляет карточку товара и управляет её отображением в каталоге и модальном окне.

 ## Свойства:

 1. product: данные о товаре (тип Product).
 2. element: DOM-элемент карточки.
 3. cartModel: модель корзины.
 4. modal: компонент модального окна.
 5. events: экземпляр EventEmitter.

 ## Методы:

 1. renderCatalogCard() — возвращает DOM-элемент карточки для каталога.
 2. renderPreviewCard() — создаёт карточку для модального окна.
 3. setEventListeners() — навешивает обработчик открытия превью и добавления в корзину.
 4. updateButtonText(button: HTMLButtonElement) — обновляет текст кнопки в зависимости от состояния корзины.
 5. getElement() — возвращает DOM-элемент карточки.

## Класс ProductModel

Модель для загрузки и хранения данных о товарах.

 ## Свойства:

 1. products: список товаров.
 2. api: экземпляр Api для загрузки данных.

 ## Методы:

 1. fetchProducts() — загружает список товаров с сервера.
 2. getAll() — возвращает текущий список товаров.

 <!---- События ---->

cart:updated - Обновление корзины: изменение количества, удаление, добавление товара.
cart:changed - Принудительный ререндер содержимого корзины.
basket:open - Открытие модального окна корзины.
checkout:start - Запуск процесса оформления заказа.
basket:clear - Очистка корзины после успешного заказа.
modal:close - Закрытие модального окна после успешного оформления заказа.
formSubmit - Успешное завершение 1-го и 2-го шага заказа
